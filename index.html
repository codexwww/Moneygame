<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Money Game</title>
<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #0f172a;
    color: white;
    display: flex;
}

.sidebar {
    width: 220px;
    background: #020617;
    height: 100vh;
    padding: 20px;
}

.menu-item {
    margin: 15px 0;
    cursor: pointer;
    color: #cbd5f5;
    font-weight: bold;
}
.menu-item:hover { color: #22c55e; }

.content {
    flex: 1;
    padding: 30px;
}

.card {
    background: #1e293b;
    padding: 20px;
    border-radius: 10px;
    margin-bottom: 15px;
    box-shadow: 0 0 10px rgba(0,255,0,0.2);
    transition: all 0.3s ease;
}

.card.up { box-shadow: 0 0 10px rgba(34,197,94,0.5); }
.card.down { box-shadow: 0 0 10px rgba(239,68,68,0.5); }

.action {
    display: flex;
    justify-content: space-between;
    cursor: pointer;
    padding: 10px;
}

.up { color: #22c55e; }
.down { color: #ef4444; }

canvas {
    background: #020617;
    border-radius: 10px;
    margin-top: 15px;
}

input {
    padding: 8px;
    width: 140px;
    margin-right: 10px;
}

button {
    padding: 8px 14px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    background: #22c55e;
    color: black;
    margin-right: 5px;
    transition: all 0.2s ease;
}
button:hover { background: #16a34a; }

h1 { margin-top: 0; }
</style>
</head>
<body>

<div class="sidebar">
    <h2>üí∞ Money Game</h2>
    <div class="menu-item" onclick="dashboard()">üè† Accueil</div>
    <div class="menu-item" onclick="investPage()">üìà Investir</div>
    <div class="menu-item" onclick="helpPage()">‚ùì Help</div>
</div>

<div class="content" id="content"></div>

<script>
// ===== VARIABLES GLOBALES =====
let currentPage = "dashboard"; // dashboard / invest / action_x / help
let currentActionId = null;

let argent = localStorage.getItem("argent")
    ? parseFloat(localStorage.getItem("argent"))
    : 10000;

let portfolio = localStorage.getItem("portfolio")
    ? JSON.parse(localStorage.getItem("portfolio"))
    : {0:0,1:0,2:0};

const actions = [
    loadAction(0,"Alpha Corp",100),
    loadAction(1,"Beta Industries",250),
    loadAction(2,"Gamma Tech",500)
];

function loadAction(id, nom, prix) {
    let saved = localStorage.getItem("action_"+id);
    if (saved) return JSON.parse(saved);
    return { id, nom, prix, prev: prix, timer: rand(), history: [prix] };
}

function rand() { return Math.floor(Math.random()*5+1)*60; }

function save() {
    localStorage.setItem("argent", argent);
    localStorage.setItem("portfolio", JSON.stringify(portfolio));
    actions.forEach(a=>localStorage.setItem("action_"+a.id, JSON.stringify(a)));
}

// ==== CALCUL DU RANG ====
function getRank() {
    let total = argent;
    actions.forEach(a=>total += portfolio[a.id]*a.prix);

    if(total<10000) return "D√©butant";
    else if(total<20000) return "Amateur";
    else if(total<50000) return "Pro";
    else return "Expert";
}

// ==== DASHBOARD AM√âLIOR√â ====
function dashboard() {
    currentPage = "dashboard";
    let value = 0;
    actions.forEach(a => value += portfolio[a.id]*a.prix);

    let html = `<h1>Tableau de bord</h1>
        <div class="card">üí∞ Argent disponible : ${argent.toFixed(2)} ‚Ç¨</div>
        <div class="card">üíº Valeur du portefeuille : ${value.toFixed(2)} ‚Ç¨</div>
        <div class="card">üèÖ Rang : ${getRank()}</div>
        <div class="card">
            <strong>D√©tails du portefeuille :</strong><br>`;
    actions.forEach(a=>{
        html+=`${a.nom} : ${portfolio[a.id].toFixed(4)} parts (valeur : ${(portfolio[a.id]*a.prix).toFixed(2)} ‚Ç¨)<br>`;
    });
    html+=`</div>`;
    document.getElementById("content").innerHTML = html;
}

// ==== INVEST PAGE ====
function investPage() {
    currentPage = "invest";
    let html = `<h1>Investir</h1>`;
    actions.forEach(a=>{
        let diff = (((a.prix-a.prev)/a.prev)*100).toFixed(2);
        html += `<div class="card ${diff>=0?'up':'down'} action" onclick="openAction(${a.id})">
            <div>
                <strong>${a.nom}</strong><br>
                <span class="${diff>=0?'up':'down'}">${diff>=0?'‚ñ≤':'‚ñº'} ${diff} %</span>
            </div>
            <div>‚è±Ô∏è ${a.timer}s</div>
        </div>`;
    });
    document.getElementById("content").innerHTML = html;
}

// ==== ACTION DETAIL ====
function openAction(id) {
    currentPage = "action_"+id;
    currentActionId = id;
    let a = actions[id];
    document.getElementById("content").innerHTML = `
        <h1>${a.nom}</h1>
        <canvas id="chart" width="700" height="250"></canvas>

        <div class="card">
            <button onclick="drawChart(${id},60)">1h</button>
            <button onclick="drawChart(${id},300)">1 jour</button>
            <button onclick="drawChart(${id},1000)">1 semaine</button>
        </div>

        <div class="card">
            üí≤ Prix : ${a.prix} ‚Ç¨<br>
            üì¶ Parts : ${portfolio[id].toFixed(4)}
        </div>

        <div class="card">
            <input id="amount" type="number" placeholder="Montant ‚Ç¨">
            <br><br>
            <button onclick="buy(${id})">Investir</button>
            <button onclick="sell(${id})">R√©cup√©rer</button>
        </div>

        <div class="card">üèÖ Rang : ${getRank()}</div>

        <button onclick="investPage()">‚¨Ö Retour</button>
    `;
    drawChart(id,60);
}

// ==== COURBE ====
function drawChart(id, points) {
    let a = actions[id];
    let data = a.history.slice(-points);
    let c = document.getElementById("chart");
    let ctx = c.getContext("2d");
    ctx.clearRect(0,0,c.width,c.height);

    let max = Math.max(...data);
    let min = Math.min(...data);

    ctx.beginPath();
    ctx.strokeStyle = "#22c55e";

    data.forEach((v,i)=>{
        let x = i*(c.width/data.length);
        let y = c.height - ((v-min)/(max-min||1))*c.height;
        if(i===0) ctx.moveTo(x,y);
        else ctx.lineTo(x,y);
    });
    ctx.stroke();
}

// ==== BUY / SELL ====
function buy(id) {
    let amount = parseFloat(document.getElementById("amount").value);
    let a = actions[id];
    if(!amount || amount>argent) return alert("Montant invalide");
    portfolio[id]+=amount/a.prix;
    argent-=amount;
    save();
    openAction(id);
}

function sell(id) {
    let amount = parseFloat(document.getElementById("amount").value);
    let a = actions[id];
    let parts = amount/a.prix;
    if(!amount || parts>portfolio[id]) return alert("Montant invalide");
    portfolio[id]-=parts;
    argent+=amount;
    save();
    openAction(id);
}

// ==== HELP PAGE ====
function helpPage() {
    currentPage = "help";
    currentActionId = null;
    document.getElementById("content").innerHTML = `
        <h1>üìò Aide / Instructions</h1>
        <div class="card">
            <h3>Argent vs Portefeuille</h3>
            <p>
                üí∞ Argent : votre cash disponible pour investir.<br>
                üíº Portefeuille : parts d'actions poss√©d√©es. Valeur = parts √ó prix actuel.<br>
                Total compte = Argent + Portefeuille
            </p>
        </div>

        <div class="card">
            <h3>Investir / Vendre</h3>
            <p>
                1Ô∏è‚É£ Cliquez sur "Investir" pour voir les actions.<br>
                2Ô∏è‚É£ Cliquez sur une action pour voir sa courbe.<br>
                3Ô∏è‚É£ Entrez le montant √† investir ou r√©cup√©rer, puis cliquez sur le bouton.<br>
                ‚ö†Ô∏è Vous ne pouvez pas investir plus que votre argent disponible, ni r√©cup√©rer plus que vos parts.
            </p>
        </div>

        <div class="card">
            <h3>Courbes</h3>
            <p>
                üìà Les courbes montrent l'√©volution du prix. Utilisez les boutons 1h / 1 jour / 1 semaine.
            </p>
        </div>

        <div class="card">
            <h3>Rang</h3>
            <p>
                üèÖ Votre rang d√©pend de Argent + Portefeuille.<br>
                - D√©butant : < 10‚ÄØ000 ‚Ç¨<br>
                - Amateur : 10‚ÄØ000 ‚Äì 20‚ÄØ000 ‚Ç¨<br>
                - Pro : 20‚ÄØ000 ‚Äì 50‚ÄØ000 ‚Ç¨<br>
                - Expert : > 50‚ÄØ000 ‚Ç¨
            </p>
        </div>

        <div class="card">
            <h3>Astuce</h3>
            <p>
                Commencez petit, suivez les courbes, et n‚Äôinvestissez pas tout d‚Äôun coup !
            </p>
        </div>
    `;
}

// ==== MARKET LOOP =====
setInterval(()=>{
    actions.forEach(a=>{
        a.timer--;
        if(a.timer<=0){
            a.prev=a.prix;
            a.prix=Math.max(10,Math.floor(a.prix*(1+(Math.random()*0.2-0.1))));
            a.history.push(a.prix);
            if(a.history.length>2000) a.history.shift();
            a.timer=rand();
            save();
        }
    });

    // Seule la page action ouverte ou invest page est mise √† jour
    if(currentPage === "invest") investPage();
    if(currentPage && currentPage.startsWith("action_")) openAction(currentActionId);

},1000);

// ==== START ====
dashboard();
</script>
</body>
</html>
