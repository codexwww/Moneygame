<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Money Game</title>

<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #0f172a;
    color: white;
    display: flex;
}

.sidebar {
    width: 220px;
    background: #020617;
    height: 100vh;
    padding: 20px;
}

.menu-item {
    margin: 15px 0;
    cursor: pointer;
    color: #cbd5f5;
}
.menu-item:hover { color: #22c55e; }

.content {
    flex: 1;
    padding: 30px;
}

.card {
    background: #1e293b;
    padding: 20px;
    border-radius: 10px;
    margin-bottom: 15px;
}

.action {
    display: flex;
    justify-content: space-between;
    cursor: pointer;
}

.up { color: #22c55e; }
.down { color: #ef4444; }

canvas {
    background: #020617;
    border-radius: 10px;
}

input {
    padding: 8px;
    width: 140px;
    margin-right: 10px;
}

button {
    padding: 8px 14px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    background: #22c55e;
    color: black;
    margin-right: 5px;
}
</style>
</head>

<body>

<div class="sidebar">
    <h2>ğŸ’° Money Game</h2>
    <div class="menu-item" onclick="dashboard()">ğŸ  Accueil</div>
    <div class="menu-item" onclick="investPage()">ğŸ“ˆ Investir</div>
    <div class="menu-item" onclick="helpPage()">â“ Help</div>
</div>

<div class="content" id="content"></div>

<script>
let argent = localStorage.getItem("argent")
    ? parseFloat(localStorage.getItem("argent"))
    : 10000;

let portfolio = localStorage.getItem("portfolio")
    ? JSON.parse(localStorage.getItem("portfolio"))
    : {0:0,1:0,2:0};

const actions = [
    loadAction(0,"Alpha Corp",100),
    loadAction(1,"Beta Industries",250),
    loadAction(2,"Gamma Tech",500)
];

function loadAction(id, nom, prix) {
    let saved = localStorage.getItem("action_"+id);
    if (saved) return JSON.parse(saved);
    return { id, nom, prix, prev: prix, timer: rand(), history: [prix] };
}

function rand() { return Math.floor(Math.random()*5+1)*60; }

function save() {
    localStorage.setItem("argent", argent);
    localStorage.setItem("portfolio", JSON.stringify(portfolio));
    actions.forEach(a=>localStorage.setItem("action_"+a.id, JSON.stringify(a)));
}

/* CALCUL DU RANG */
function getRank() {
    let total = argent;
    actions.forEach(a=>total += portfolio[a.id]*a.prix);

    if(total<10000) return "DÃ©butant";
    else if(total<20000) return "Amateur";
    else if(total<50000) return "Pro";
    else return "Expert";
}

/* DASHBOARD AMÃ‰LIORÃ‰ */
function dashboard() {
    let value = 0;
    actions.forEach(a => value += portfolio[a.id]*a.prix);

    let html = `<h1>Tableau de bord</h1>
        <div class="card">ğŸ’° Argent disponible : ${argent.toFixed(2)} â‚¬</div>
        <div class="card">ğŸ’¼ Valeur du portefeuille : ${value.toFixed(2)} â‚¬</div>
        <div class="card">ğŸ… Rang : ${getRank()}</div>
        <div class="card">
            <strong>DÃ©tails du portefeuille :</strong><br>`;
    actions.forEach(a=>{
        html+=`${a.nom} : ${portfolio[a.id].toFixed(4)} parts (valeur : ${(portfolio[a.id]*a.prix).toFixed(2)} â‚¬)<br>`;
    });
    html+=`</div>`;
    document.getElementById("content").innerHTML = html;
}

/* INVEST PAGE */
function investPage() {
    let html = `<h1>Investir</h1>`;
    actions.forEach(a=>{
        let diff = (((a.prix-a.prev)/a.prev)*100).toFixed(2);
        html += `<div class="card action" onclick="openAction(${a.id})">
            <div>
                <strong>${a.nom}</strong><br>
                <span class="${diff>=0?'up':'down'}">${diff>=0?'â–²':'â–¼'} ${diff} %</span>
            </div>
            <div>â±ï¸ ${a.timer}s</div>
        </div>`;
    });
    document.getElementById("content").innerHTML = html;
}

/* ACTION DETAIL */
function openAction(id) {
    let a = actions[id];
    document.getElementById("content").innerHTML = `
        <h1>${a.nom}</h1>
        <canvas id="chart" width="700" height="250"></canvas>

        <div class="card">
            <button onclick="drawChart(${id},60)">1h</button>
            <button onclick="drawChart(${id},300)">1 jour</button>
            <button onclick="drawChart(${id},1000)">1 semaine</button>
        </div>

        <div class="card">
            ğŸ’² Prix : ${a.prix} â‚¬<br>
            ğŸ“¦ Parts : ${portfolio[id].toFixed(4)}
        </div>

        <div class="card">
            <input id="amount" type="number" placeholder="Montant â‚¬">
            <br><br>
            <button onclick="buy(${id})">Investir</button>
            <button onclick="sell(${id})">RÃ©cupÃ©rer</button>
        </div>

        <div class="card">ğŸ… Rang : ${getRank()}</div>

        <button onclick="investPage()">â¬… Retour</button>
    `;
    drawChart(id,60);
}

/* COURBE */
function drawChart(id, points) {
    let a = actions[id];
    let data = a.history.slice(-points);
    let c = document.getElementById("chart");
    let ctx = c.getContext("2d");
    ctx.clearRect(0,0,c.width,c.height);

    let max = Math.max(...data);
    let min = Math.min(...data);

    ctx.beginPath();
    ctx.strokeStyle = "#22c55e";

    data.forEach((v,i)=>{
        let x = i*(c.width/data.length);
        let y = c.height - ((v-min)/(max-min||1))*c.height;
        if(i===0) ctx.moveTo(x,y);
        else ctx.lineTo(x,y);
    });
    ctx.stroke();
}

/* BUY / SELL */
function buy(id) {
    let amount = parseFloat(document.getElementById("amount").value);
    let a = actions[id];
    if(!amount || amount>argent) return alert("Montant invalide");
    portfolio[id]+=amount/a.prix;
    argent-=amount;
    save();
    openAction(id);
}

function sell(id) {
    let amount = parseFloat(document.getElementById("amount").value);
    let a = actions[id];
    let parts = amount/a.prix;
    if(!amount || parts>portfolio[id]) return alert("Montant invalide");
    portfolio[id]-=parts;
    argent+=amount;
    save();
    openAction(id);
}

/* HELP PAGE */
function helpPage() {
    document.getElementById("content").innerHTML = `
        <h1>ğŸ“˜ Aide / Instructions</h1>
        <div class="card">
            <h3>Argent vs Portefeuille</h3>
            <p>
                ğŸ’° Argent : votre cash disponible pour investir.<br>
                ğŸ’¼ Portefeuille : parts d'actions possÃ©dÃ©es. Valeur = parts Ã— prix actuel.<br>
                Total compte = Argent + Portefeuille
            </p>
        </div>

        <div class="card">
            <h3>Investir / Vendre</h3>
            <p>
                1ï¸âƒ£ Cliquez sur "Investir" pour voir les actions.<br>
                2ï¸âƒ£ Cliquez sur une action pour voir sa courbe.<br>
                3ï¸âƒ£ Entrez le montant Ã  investir ou rÃ©cupÃ©rer, puis cliquez sur le bouton.<br>
                âš ï¸ Vous ne pouvez pas investir plus que votre argent disponible, ni rÃ©cupÃ©rer plus que vos parts.
            </p>
        </div>

        <div class="card">
            <h3>Courbes</h3>
            <p>
                ğŸ“ˆ Les courbes montrent l'Ã©volution du prix. Utilisez les boutons 1h / 1 jour / 1 semaine.
            </p>
        </div>

        <div class="card">
            <h3>Rang</h3>
            <p>
                ğŸ… Votre rang dÃ©pend de Argent + Portefeuille.<br>
                - DÃ©butant : < 10â€¯000 â‚¬<br>
                - Amateur : 10â€¯000 â€“ 20â€¯000 â‚¬<br>
                - Pro : 20â€¯000 â€“ 50â€¯000 â‚¬<br>
                - Expert : > 50â€¯000 â‚¬
            </p>
        </div>

        <div class="card">
            <h3>Astuce</h3>
            <p>
                Commencez petit, suivez les courbes, et nâ€™investissez pas tout dâ€™un coup !
            </p>
        </div>
    `;
}

/* MARKET LOOP */
setInterval(()=>{
    actions.forEach(a=>{
        a.timer--;
        if(a.timer<=0){
            a.prev=a.prix;
            a.prix=Math.max(10,Math.floor(a.prix*(1+(Math.random()*0.2-0.1))));
            a.history.push(a.prix);
            if(a.history.length>2000) a.history.shift();
            a.timer=rand();
            save();
        }
    });

    // Ne recharge la page que si on est sur la liste des investissements, pas sur action ouverte
    if(document.getElementById("content").innerHTML.includes("Investir") &&
       !document.getElementById("content").innerHTML.includes("canvas")) {
        investPage();
    }
},1000);

/* START */
dashboard();
</script>

</body>
</html>
